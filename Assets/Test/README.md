# WebSocket ジャイロデータ中継システム

Unityとスマートフォン間でジャイロデータを低遅延でやり取りするためのWebSocket中継サーバーシステムです。

## 📋 システム構成

```
スマートフォン (Web) → Node.js中継サーバー → Unity (C#)
```

1. **スマートフォン (Web)**: ジャイロデータを取得し、サーバーに送信
2. **中継サーバー (Node.js)**: データを受信し、Unityに転送
3. **Unity (C#)**: サーバーに接続し、データを受信してゲーム操作に反映

## 🚀 セットアップ

### 1. Node.jsサーバーのセットアップ

#### 必要なもの
- Node.js (v14以上推奨)
- npm (Node.jsに含まれています)

#### インストール手順

```bash
# 依存関係をインストール
npm install

# サーバーを起動
npm start
```

または

```bash
node server.js
```

サーバーが起動すると、以下のメッセージが表示されます：

```
=== WebSocket中継サーバーが起動しました ===
ポート: 8080
接続URL: ws://localhost:8080
=========================================
```

### 2. Unity側のセットアップ

1. Unityプロジェクトを開く
2. `Assets/Test/Test.cs`を確認
3. Inspectorで`Server Url`を設定:
   - ローカル: `ws://localhost:8080`
   - リモート: `ws://YOUR_IP:8080` (YOUR_IPはサーバーのIPアドレス)

### 3. スマートフォン側のセットアップ

1. サーバーと同じWi-Fiネットワークに接続
2. ブラウザで`Web/index.html`を開く
3. サーバーURLを入力:
   - ローカル: `ws://localhost:8080` (開発用)
   - リモート: `ws://YOUR_IP:8080` (YOUR_IPはサーバーのIPアドレス)
4. 「ジャイロを有効化」ボタンをクリック
5. ジャイロセンサーの許可を与える

## 📱 使い方

### サーバーを起動

```bash
node server.js
```

### Unity側

1. Unityでゲームを実行
2. サーバーに自動接続
3. ジャイロデータを受信してゲーム操作に反映

### スマートフォン側

1. ブラウザで`Web/index.html`を開く
2. サーバーURLを入力
3. 「ジャイロを有効化」ボタンをクリック
4. ジャイロセンサーの許可を与える
5. 自動的にジャイロデータがサーバーに送信されます

## 🔧 設定

### サーバーのポート番号を変更

`server.js`の`PORT`定数を変更:

```javascript
const PORT = 8080; // 任意のポート番号に変更
```

### Unity側の送信頻度を変更

`Web/index.html`の`SEND_INTERVAL_MS`を変更:

```javascript
const SEND_INTERVAL_MS = 50; // ミリ秒（デフォルト: 50ms = 20fps）
```

## 🐛 トラブルシューティング

### 接続できない場合

1. **ファイアウォールの確認**
   - サーバーのポート（デフォルト: 8080）が開放されているか確認
   - Windowsファイアウォールでポートを許可

2. **IPアドレスの確認**
   - サーバーとクライアントが同じWi-Fiネットワークに接続されているか確認
   - サーバーのIPアドレスを確認:
     - Windows: `ipconfig`
     - Mac/Linux: `ifconfig`

3. **サーバーの起動確認**
   - サーバーが正常に起動しているか確認
   - エラーメッセージを確認

### ジャイロデータが送信されない場合

1. **ブラウザの許可確認**
   - ジャイロセンサーへのアクセス許可を確認
   - iOSの場合は設定から許可が必要な場合があります

2. **HTTPS接続**
   - 一部のブラウザでは、HTTPS接続が必要な場合があります
   - ローカル開発の場合は`localhost`を使用

## 📝 ファイル構成

```
.
├── server.js          # Node.js WebSocket中継サーバー
├── package.json       # Node.js依存関係
├── README.md          # このファイル
├── Assets/
│   └── Test/
│       ├── Test.cs    # Unity WebSocketクライアント
│       └── Web/
│           └── index.html  # スマートフォン用Webクライアント
```

## 📄 ライセンス

MIT License

